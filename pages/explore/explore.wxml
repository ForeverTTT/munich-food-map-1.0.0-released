<!--pages/explore/explore.wxml-->
<view class="container">

  <!-- èƒŒæ™¯å›¾ -->
  <image class="bg-image" src="{{bgImageUrl}}" mode="aspectFill"></image>
  <view class="banner-overlay"></view>
  
  
  <!-- å…¨å±åŠ è½½åŠ¨ç”» -->
  <view class="fullscreen-loading" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>
  
  <!-- å†…å®¹æ ‡é¢˜ -->
  <view class="page-header">
    <view class="title">æ¢åº—æ—¥è®°</view>
    <view class="category-section">
      <view class="filter-tags">
        <view class="category-item {{activeCategory === 'all' ? 'active' : ''}}" bindtap="switchCategory" data-category="all">
          <text>å…¨éƒ¨</text>
        </view>
        <view class="category-item {{activeCategory === 'ç¾é£Ÿ' ? 'active' : ''}}" bindtap="switchCategory" data-category="ç¾é£Ÿ">
          <text>ç¾é£Ÿ</text>
        </view>
        <view class="category-item {{activeCategory === 'é¥®å“' ? 'active' : ''}}" bindtap="switchCategory" data-category="é¥®å“">
          <text>é¥®å“</text>
        </view>
        <view class="category-item {{activeCategory === 'å°åƒ' ? 'active' : ''}}" bindtap="switchCategory" data-category="å°åƒ">
          <text>å°åƒ</text>
        </view>
      </view>
      <view class="add-post-btn" bindtap="onCreatePost">
        <text class="plus">+</text>
      </view>
    </view>
  </view>
  
  <!-- åŠ è½½ä¸­æç¤º -->
  <view class="loading-container" wx:if="{{isLoading && posts.length === 0 && false}}">
    <view class="loading-icon"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
  
  <!-- æ— æ•°æ®æç¤º -->
  <view class="empty-container" wx:if="{{!isLoading && posts.length === 0}}">
    <text class="empty-text">æš‚æ— æ¢åº—æ—¥è®°</text>
    <text class="empty-desc">å¿«æ¥è®°å½•ä½ çš„æ¢åº—ä½“éªŒå§ï¼</text>
    <view class="empty-button" bindtap="onCreatePost">å‘å¸ƒ</view>
  </view>
  
  <!-- å¸–å­åˆ—è¡¨ -->
  <view class="posts-section" wx:if="{{posts.length > 0}}">
    <view class="post-list">
      <view class="post-item" wx:for="{{posts}}" wx:key="_id" id="post-{{item._id}}">
        <view class="post-header">
          <view class="user-avatar">
            <view class="avatar-placeholder">{{item.username[0] || 'ç¾'}}</view>
          </view>
          <view class="user-info">
            <text class="username">{{item.username || 'ç¾é£Ÿæ¢åº—å®¶'}}</text>
            <view class="shop-info">
              <text class="shop-name">{{item.shopName}}</text>
              <view class="rating-container">
                <text class="rating-value">{{item.rating || 0}}</text>
                <text class="rating-star">â˜…</text>
              </view>
              <text class="post-date">{{item.createTime}}</text>
            </view>
            <!-- åˆ é™¤æŒ‰é’® -->
            <view wx:if="{{item.isOwnPost}}" class="delete-button" catchtap="deletePost" data-id="{{item._id}}">
              <view class="trash-icon">ğŸ—‘ï¸</view>
            </view>
          </view>
        </view>

        <!-- å¸–å­å†…å®¹ -->
        <view class="post-content">
          <text class="post-text">{{item.content || 'è¯¥ç”¨æˆ·æœªç•™ä¸‹è¯„ä»·å†…å®¹~'}}</text>

          <!-- å¸–å­å›¾ç‰‡ -->
          <view class="post-image-container" wx:if="{{item.images && item.images.length > 0}}">
            <image class="post-image" src="{{item.images[0]}}" mode="aspectFill" bindtap="previewImage" data-urls="{{item.images}}" data-current="{{item.images[0]}}"></image>
          </view>
          
          <!-- æ ‡ç­¾ -->
          <view class="tags-container" wx:if="{{item.tags && item.tags.length > 0}}">
            <view class="tag-item" wx:for="{{item.tags}}" wx:for-item="tag" wx:key="index">
              <text>#{{tag}}</text>
            </view>
          </view>
        </view>

        <view class="post-divider"></view>

        <!-- äº’åŠ¨åŒºåŸŸ -->
        <view class="post-actions">
          <!-- ç‚¹èµ -->
          <view class="action-item {{item.isLiked ? 'liked' : ''}}" bindtap="onLike" data-id="{{item._id}}">
            <text class="action-icon">â¤</text>
            <text class="action-count">{{item.likes || 0}}</text>
          </view>
          
          <!-- è¯„è®º -->
          <view class="action-item" bindtap="toggleComments" data-id="{{item._id}}">
            <text class="action-icon">ğŸ’¬</text>
            <text class="action-count">{{item.comments.length || 0}}</text>
          </view>
          
          <!-- åˆ†äº« -->
          <button class="share-button" open-type="share" data-id="{{item._id}}">
            <text class="action-icon">ğŸ”—</text>
            <text class="action-text">åˆ†äº«</text>
          </button>
        </view>
        
        <!-- è¯„è®ºåŒºåŸŸ -->
        <view class="comments-section" wx:if="{{item.showComments}}">
          <view class="comment-list" wx:if="{{item.comments && item.comments.length > 0}}">
            <view class="comment-item" wx:for="{{item.comments}}" wx:for-item="comment" wx:key="index">
              <view class="comment-avatar">
                <view class="avatar-small">{{comment.username[0] || 'ç”¨'}}</view>
              </view>
              <view class="comment-content">
                <view class="comment-user">
                  <text class="comment-username">{{comment.username}}</text>
                  <text class="comment-time">{{comment.createTime}}</text>
                </view>
                <text class="comment-text">{{comment.content}}</text>
              </view>
            </view>
          </view>
          <view class="no-comments" wx:else>
            <text>æš‚æ— è¯„è®ºï¼Œå¿«æ¥æ·»åŠ ç¬¬ä¸€æ¡è¯„è®ºå§</text>
          </view>

          <!-- è¯„è®ºè¾“å…¥æ¡† -->
          <view class="comment-input-container">
            <input class="comment-input" placeholder="å†™ä¸‹ä½ çš„è¯„è®º..." value="{{commentText}}" bindinput="onCommentInput" data-id="{{item._id}}" confirm-type="send" bindconfirm="submitComment" />
            <view class="comment-submit {{commentText ? 'active' : ''}}" bindtap="submitComment" data-id="{{item._id}}">å‘é€</view>
          </view>
        </view>
      </view>
      
      <!-- åº•éƒ¨åŠ è½½æ›´å¤šåŒºåŸŸ -->
      <view class="load-more-section">
        <view class="load-more-button" bindtap="loadMorePosts" wx:if="{{hasMoreData && !isLoadingMore && !isLoading}}">
          <text class="load-more-text">åŠ è½½æ›´å¤š</text>
        </view>
        
        <view class="loading-more" wx:if="{{isLoadingMore}}">
          <view class="loading-icon-small"></view>
          <text class="loading-more-text">åŠ è½½ä¸­...</text>
        </view>
        
        <view class="no-more-data" wx:if="{{!hasMoreData && posts.length > 0 && !isLoading}}">
          <text class="no-more-text">å·²ç»åˆ°åº•å•¦~</text>
        </view>
      </view>
    </view>
  </view>
  
  <!-- åº•éƒ¨å‘å¸–æŒ‰é’® -->
  <view class="floating-button" bindtap="onCreatePost">
    <text class="float-plus">+</text>
    <text class="float-text">å‘å¸ƒæ¢åº—</text>
  </view>
</view>