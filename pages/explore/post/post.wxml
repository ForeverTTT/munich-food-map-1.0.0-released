<!-- pages/explore/post/post.wxml -->
<view class="container">
  <view class="page-header">
    <view class="header-content">
      <view class="back-btn" bindtap="onCancel">
        <text class="back-icon">←</text>
      </view>
      <view class="header-text">
        <view class="title">发布探店记录</view>
        <view class="subtitle">分享你的美食体验</view>
      </view>
    </view>
  </view>

  <view class="form-container">
    <!-- 店铺名称 -->
    <view class="form-group">
      <view class="form-label">店铺名称<text class="required">*</text></view>
      <input class="form-input" placeholder="请输入店铺名称" value="{{shopName}}" bindinput="onShopNameInput" maxlength="30" />
    </view>

    <!-- 美食分类 -->
    <view class="form-group">
      <view class="form-label">美食分类<text class="required">*</text></view>
      <picker mode="selector" range="{{categoryOptions}}" value="{{categoryIndex}}" bindchange="bindCategoryChange">
        <view class="form-picker">
          {{category}}
          <view class="picker-arrow"></view>
        </view>
      </picker>
    </view>

    <!-- 评分 -->
    <view class="form-group">
      <view class="form-label">店铺评分<text class="required">*</text></view>
      <view class="rating-container">
        <view class="rating-star {{rating >= 1 ? 'active' : ''}}" data-rating="1" bindtap="setRating">★</view>
        <view class="rating-star {{rating >= 2 ? 'active' : ''}}" data-rating="2" bindtap="setRating">★</view>
        <view class="rating-star {{rating >= 3 ? 'active' : ''}}" data-rating="3" bindtap="setRating">★</view>
        <view class="rating-star {{rating >= 4 ? 'active' : ''}}" data-rating="4" bindtap="setRating">★</view>
        <view class="rating-star {{rating >= 5 ? 'active' : ''}}" data-rating="5" bindtap="setRating">★</view>
        <view class="rating-text">{{rating ? rating + '星' : '点击评分'}}</view>
      </view>
    </view>

    <!-- 探店内容 -->
    <view class="form-group">
      <view class="form-label">探店内容<text class="required">*</text></view>
      <textarea class="form-textarea" placeholder="分享你的探店体验，例如菜品特色、环境、服务等" value="{{content}}" bindinput="onContentInput" maxlength="500" auto-height></textarea>
      <view class="textarea-counter">{{content.length}}/500</view>
    </view>

    <!-- 标签 -->
    <view class="form-group">
      <view class="form-label">添加标签</view>
      <view class="tag-input-container">
        <input 
          class="tag-input" 
          placeholder="添加标签，如#烤肉#家常菜" 
          value="{{tagInput}}" 
          bindinput="onTagInput" 
          maxlength="10" 
          confirm-type="done"
        />
        <view class="tag-add-btn" bindtap="addTag">添加</view>
      </view>
      
      <!-- 已添加的标签 -->
      <view class="tags-container" wx:if="{{tags.length > 0}}">
        <view class="tag-item" wx:for="{{tags}}" wx:key="index">
          <text class="tag-text">#{{item}}</text>
          <view class="tag-delete" data-index="{{index}}" bindtap="deleteTag">×</view>
        </view>
      </view>
    </view>

    <!-- 图片上传 -->
    <view class="form-group">
      <view class="form-label">上传图片 <text class="hint">(最多9张)</text></view>
      <view class="image-uploader">
        <view class="image-list">
          <!-- 已上传的图片 -->
          <view 
            class="image-item" 
            wx:for="{{imageList}}" 
            wx:key="index"
          >
            <image 
              class="uploaded-image" 
              src="{{item}}" 
              mode="aspectFill" 
              data-src="{{item}}" 
              bindtap="previewImage"
            ></image>
            <view 
              class="image-delete" 
              data-index="{{index}}" 
              bindtap="deleteImage"
            >×</view>
          </view>
          
          <!-- 添加图片按钮 -->
          <view 
            class="image-add" 
            bindtap="chooseImage" 
            wx:if="{{imageList.length < maxImageCount}}"
          >
            <view class="add-icon">+</view>
          </view>
        </view>
      </view>
      <view class="image-counter">{{imageList.length}}/{{maxImageCount}}</view>
    </view>

    <!-- 操作按钮 -->
    <view class="form-actions">
      <button 
        class="btn btn-cancel" 
        bindtap="onCancel" 
        disabled="{{isSubmitting}}"
      >取消</button>
      <button 
        class="btn btn-submit" 
        bindtap="onSubmit" 
        disabled="{{isSubmitting}}"
      >发布</button>
    </view>
  </view>
</view> 