<!--pages/friend/friend.wxml-->
<view class="container">
  <!-- èƒŒæ™¯å›¾ -->
  <image wx:if="{{bgImageUrl}}" class="bg-image" src="{{bgImageUrl}}" mode="aspectFill"></image>
  <view class="banner-overlay"></view>
  
  <!-- å¤´éƒ¨ -->
  <view class="page-header">
    <view class="title">åƒé¥­æ­å­</view>
    <view class="filter-section">
      <picker mode="date" bindchange="onDateChange" class="filter-item">
        <view class="picker-content">
          <text class="picker-label">æ—¥æœŸ</text>
          <text class="picker-value">{{selectedDate}}</text>
        </view>
      </picker>
      <picker mode="selector" range="{{mealTimeRange}}" bindchange="onMealTimeChange" class="filter-item">
        <view class="picker-content">
          <text class="picker-label">é¤æ®µ</text>
          <text class="picker-value">{{selectedMealTime}}</text>
        </view>
      </picker>
      <picker mode="selector" range="{{peopleRange}}" bindchange="onPeopleChange" class="filter-item">
        <view class="picker-content">
          <text class="picker-label">äººæ•°</text>
          <text class="picker-value">{{selectedPeople}}äºº</text>
        </view>
      </picker>
      <view class="header-post-button" bindtap="onCreatePost">
        <text class="plus">+</text>
      </view>
    </view>
  </view>
  
  <!-- åŠ è½½ä¸­æç¤º -->
  <view class="loading-container" wx:if="{{isLoading}}">
    <view class="loading-icon"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
  
  <!-- æ— æ•°æ®æç¤º -->
  <view class="empty-container" wx:if="{{!isLoading && posts.length === 0}}">
    <text class="empty-text">æš‚æ— åƒé¥­æ­å­ä¿¡æ¯</text>
    <text class="empty-desc">å¿«æ¥å‘å¸ƒæ‚¨çš„é¥­æ­å­ä¿¡æ¯å§ï¼</text>
    <view class="empty-button" bindtap="onCreatePost">å‘å¸ƒ</view>
  </view>
  
  <!-- å¸–å­åˆ—è¡¨ -->
  <view class="posts-section" wx:if="{{!isLoading && posts.length > 0}}">
    <view class="post-list">
      <view class="post-item" wx:for="{{posts}}" wx:key="_id">
        <view class="post-header">
          <view class="user-avatar">
            <view class="avatar-placeholder">{{item.username[0] || 'ç¾'}}</view>
          </view>
          <view class="user-info">
            <text class="username">{{item.username || 'ç¾é£Ÿè¾¾äºº'}}</text>
            <view class="post-tags">
              <text class="post-tag date-tag">{{item.date || selectedDate}}</text>
              <text class="post-tag meal-tag">{{item.mealTime || selectedMealTime}}</text>
              <text class="post-tag people-tag">{{item.peopleCount || selectedPeople}}äºº</text>
            </view>
          </view>
          <!-- åˆ é™¤æŒ‰é’® -->
          <view wx:if="{{item.isOwnPost}}" class="delete-button" catchtap="deletePost" data-id="{{item._id}}">
            <text class="delete-icon">ğŸ—‘ï¸</text>
          </view>
        </view>
        
        <!-- å¸–å­å†…å®¹ -->
        <view class="post-content">
          <text class="post-text">{{item.description || 'ä»Šå¤©å‘ç°äº†ä¸€å®¶è¶…èµçš„ç«é”…åº—ï¼Œå‘³é“çœŸçš„å¾ˆä¸é”™ï¼æ¨èå¤§å®¶å»å°å°~'}}</text>
          <view wx:if="{{item.wxid}}" class="wxid-container">
            <text class="wxid-label">å¾®ä¿¡ï¼š</text>
            <text class="wxid-value">{{item.wxid}}</text>
          </view>
        </view>
        
        <view class="post-divider"></view>
        
        <!-- äº’åŠ¨åŒºåŸŸ -->
        <view class="post-actions">
          <!-- ç‚¹èµ -->
          <view class="action-item {{item.isLiked ? 'liked-action' : ''}}" bindtap="onLike" data-id="{{item._id}}">
            <text class="icon {{item.isLiked ? 'liked' : ''}}">â¤</text>
            <text class="count">{{item.likes || 0}}</text>
          </view>
          
          <!-- è¯„è®º -->
          <view class="action-item" bindtap="toggleCommentInput" data-id="{{item._id}}">
            <text class="icon">ğŸ’¬</text>
            <text class="count">{{item.commentList.length || 0}}</text>
          </view>
          
          <!-- åˆ†äº« -->
          <view class="action-share">
            <text class="icon">ğŸ”—</text>
            <text class="share-text">åˆ†äº«</text>
          </view>

          <!-- çº¦é¥­æŒ‰é’® -->
          <view class="reservation-btn" bindtap="makeReservation" data-id="{{item._id}}">
            <text>+ çº¦é¥­</text>
          </view>
        </view>
        
        <!-- è¯„è®ºåŒº -->
        <view class="comments-section" wx:if="{{item.showComments || item.commentList.length > 0}}">
          <!-- è¯„è®ºåŒºæ ‡é¢˜æ  -->
          <view class="comments-header">
            <text class="comments-title">è¯„è®º ({{item.commentList.length || 0}})</text>
            <view class="comments-toggle" bindtap="toggleCommentSection" data-id="{{item._id}}">
              <text class="toggle-text">{{item.commentsCollapsed ? 'å±•å¼€' : 'æ”¶èµ·'}}</text>
              <text class="toggle-icon">{{item.commentsCollapsed ? 'â–¼' : 'â–²'}}</text>
            </view>
          </view>
          
          <!-- è¯„è®ºåˆ—è¡¨ -->
          <view class="comment-list" wx:if="{{item.commentList.length > 0 && !item.commentsCollapsed}}">
            <view class="comment-item" wx:for="{{item.commentList}}" wx:for-item="comment" wx:key="index">
              <view class="comment-avatar">
                <text>{{comment.username[0] || 'ç”¨'}}</text>
              </view>
              <view class="comment-content">
                <view class="comment-info">
                  <text class="comment-username">{{comment.username}}</text>
                  <text class="comment-time">{{comment.time || 'åˆšåˆš'}}</text>
                </view>
                <text class="comment-text">{{comment.content}}</text>
              </view>
            </view>
          </view>
          
          <!-- æ— è¯„è®ºæç¤º -->
          <view class="no-comments" wx:if="{{!item.commentList || item.commentList.length === 0 && !item.commentsCollapsed}}">
            <text>æš‚æ— è¯„è®ºï¼Œæ·»åŠ ç¬¬ä¸€æ¡è¯„è®ºå§</text>
          </view>
          
          <!-- è¯„è®ºè¾“å…¥æ¡† -->
          <view class="comment-input-container" wx:if="{{item.showCommentInput && !item.commentsCollapsed}}">
            <input 
              class="comment-input" 
              placeholder="å†™ä¸‹ä½ çš„è¯„è®º..." 
              value="{{item.commentValue || ''}}" 
              focus="{{item.inputFocus}}"
              bindinput="onCommentInput"
              data-id="{{item._id}}"
              confirm-type="send"
              bindconfirm="submitComment"
              data-id="{{item._id}}"
            />
            <view 
              class="comment-submit-btn {{item.commentValue ? 'active' : ''}}" 
              bindtap="submitComment" 
              data-id="{{item._id}}"
            >å‘é€</view>
          </view>
        </view>
      </view>
    </view>
  </view>
  
  <!-- åº•éƒ¨å‘å¸–æŒ‰é’® -->
  <view class="floating-button" bindtap="onCreatePost">
    <text class="float-plus">+</text>
    <text class="float-text">çº¦é¥­</text>
  </view>
</view>