<!--pages/friend/friend.wxml-->
<view class="container">
  <!-- 背景图 -->
  <image class="bg-image" src="{{bgImageUrl}}" mode="aspectFill"></image>
  <view class="banner-overlay"></view>
  
  <!-- 全屏加载动画 -->
  <view class="fullscreen-loading" wx:if="{{isLoading && posts.length === 0}}">
    <view class="loading-spinner"></view>
    <view class="loading-text">加载中...</view>
  </view>
  
  <!-- 头部 -->
  <view class="page-header">
    <view class="title">吃饭搭子</view>
    <view class="filter-section">
      <picker mode="date" bindchange="onDateChange" class="filter-item">
        <view class="picker-content">
          <text class="picker-label">日期</text>
          <text class="picker-value">{{selectedDate}}</text>
        </view>
      </picker>
      <picker mode="selector" range="{{mealTimeRange}}" bindchange="onMealTimeChange" class="filter-item">
        <view class="picker-content">
          <text class="picker-label">餐段</text>
          <text class="picker-value">{{selectedMealTime}}</text>
        </view>
      </picker>
      <picker mode="selector" range="{{peopleRange}}" bindchange="onPeopleChange" class="filter-item">
        <view class="picker-content">
          <text class="picker-label">人数</text>
          <text class="picker-value">{{selectedPeople}}人</text>
        </view>
      </picker>
      <view class="header-post-button" bindtap="onCreatePost">
        <text class="plus">+</text>
      </view>
    </view>
  </view>
  
  <!-- 加载中提示 -->
  <view class="loading-container" wx:if="{{isLoading && posts.length === 0}}">
    <view class="loading-icon"></view>
    <text class="loading-text">加载中...</text>
  </view>
  
  <!-- 无数据提示 -->
  <view class="empty-container" wx:if="{{!isLoading && posts.length === 0}}">
    <text class="empty-text">暂无吃饭搭子信息</text>
    <text class="empty-desc">快来发布您的饭搭子信息吧！</text>
    <view class="empty-button" bindtap="onCreatePost">发布</view>
  </view>
  
  <!-- 帖子列表 -->
  <view class="posts-section" wx:if="{{posts.length > 0}}">
    <view class="post-list">
      <view class="post-item" wx:for="{{posts}}" wx:key="_id" id="post-{{item._id}}">
        <!-- 删除按钮 -->
        <view wx:if="{{item.isOwnPost}}" class="delete-button" catchtap="deletePost" data-id="{{item._id}}">
          <view class="trash-icon">🗑️</view>
        </view>
        
        <view class="post-header">
          <view class="user-avatar">
            <view class="avatar-placeholder">{{item.username[0] || '美'}}</view>
          </view>
          <view class="user-info">
            <text class="username">{{item.username || '美食达人'}}</text>
            <view class="post-tags">
              <text class="post-tag date-tag">{{item.date || selectedDate}}</text>
              <text class="post-tag meal-tag">{{item.mealTime || selectedMealTime}}</text>
              <text class="post-tag people-tag">{{item.peopleCount || selectedPeople}}人</text>
            </view>
          </view>
        </view>
        
        <!-- 帖子内容 -->
        <view class="post-content">
          <text class="post-text">{{item.description || '该用户没有留下任何信息~'}}</text>
          <view class="contact-share-row">
            <view wx:if="{{item.wxid}}" class="wxid-container" bindtap="copyWxid" data-wxid="{{item.wxid}}">
              <text class="wxid-label">微信：</text>
              <text class="wxid-value">{{item.wxid}}</text>
              <view class="copy-icon">复制</view>
            </view>
            <button class="share-button" open-type="share" data-id="{{item._id}}">
              <text class="icon">🔗</text>
              <text class="share-text">分享</text>
            </button>
          </view>
        </view>
      </view>
      
      <!-- 底部加载更多区域 -->
      <view class="load-more-section">
        <view class="load-more-button" bindtap="loadMorePosts" wx:if="{{hasMoreData && !isLoadingMore && !isLoading}}">
          <text class="load-more-text">加载更多</text>
        </view>
        
        <view class="loading-more" wx:if="{{isLoadingMore}}">
          <view class="loading-icon-small"></view>
          <text class="loading-more-text">加载中...</text>
        </view>
        
        <view class="no-more-data" wx:if="{{!hasMoreData && posts.length > 0 && !isLoading}}">
          <text class="no-more-text">已经到底啦~</text>
        </view>
      </view>
    </view>
  </view>
  
  <!-- 底部发帖按钮 -->
  <view class="floating-button" bindtap="onCreatePost">
    <text class="float-plus">+</text>
    <text class="float-text">发布</text>
  </view>
</view>